<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Bradley Druzinsky and Connor Ford" />


<title>Extreme Weather and Terrorism</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-1.1/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>
<script src="site_libs/htmlwidgets-0.9/htmlwidgets.js"></script>
<script src="site_libs/plotly-binding-4.7.1/plotly.js"></script>
<script src="site_libs/typedarray-0.1/typedarray.min.js"></script>
<link href="site_libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="site_libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<link href="site_libs/plotlyjs-1.29.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="site_libs/plotlyjs-1.29.2/plotly-latest.min.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Terrorism and Extreme Weather</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="MasterData.html">Analysis</a>
</li>
<li class="dropdown-header">About Us</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Extreme Weather and Terrorism</h1>
<h4 class="author"><em>Bradley Druzinsky and Connor Ford</em></h4>

</div>


<p>Our initial analysis concerns two datasets. The first is a Global Terrorism Database which has information on over 170,000 terrorist attacks since 1970. Each unit in the database is an attack and includes information on the time, location, tactics, perpetrators, and targets of said attack. From the source of the dataset, a ‘terrorist attack’ is: “The threatened or actual use of illegal force and violence by a non-state actor to attain a political, economic, religious, or social goal through fear, coercion, or intimidation.” (SMART at University of Maryland)</p>
<p>The second data set is a Berkeley Earth dataset which contains average monthly temperature for a particular location, (i.e. city, state, or country), with data going back to 1750.</p>
<p><strong>Some important features (variables) in the terrorism and temperature data sets</strong></p>
<div id="terrorism-set-httpswww.kaggle.comstart-umdgtddata" class="section level4">
<h4>Terrorism Set (<a href="https://www.kaggle.com/START-UMD/gtd/data" class="uri">https://www.kaggle.com/START-UMD/gtd/data</a>)</h4>
<ul>
<li>Event id</li>
<li>Date</li>
<li>Country</li>
<li>City</li>
<li>Latitude, Longitude</li>
<li>Summary (of attack)</li>
<li>Attack type (hostage, assassination, bombing, etc..)</li>
<li>Weapon type</li>
<li>Number killed</li>
</ul>
</div>
<div id="temperature-set-httpswww.kaggle.comberkeleyearthclimate-change-earth-surface-temperature-datadata" class="section level4">
<h4>Temperature Set (<a href="https://www.kaggle.com/berkeleyearth/climate-change-earth-surface-temperature-data/data" class="uri">https://www.kaggle.com/berkeleyearth/climate-change-earth-surface-temperature-data/data</a>)</h4>
<ul>
<li>Date</li>
<li>Average Temperature (of day)</li>
<li>City</li>
<li>Country</li>
<li>Latitude, Longitude</li>
</ul>
</div>
<div id="latlong---clustered-regions" class="section level4">
<h4>Lat/Long -&gt; Clustered Regions</h4>
<p>The function below takes a vector of Latitudes and a vector of Longitudes and runs Hartigan and Wong’s (1979) k-means clustering algorithm to cluster the latitude and longitudes into regions. This saves us the hassle of converting cities or lat/long coordinates to US states/territories. The function is also easily scalable for non-US lat/long coordinates.</p>
<pre class="r"><code>cluster &lt;- function(latVector, longVector) {

  set.seed(4747)                                                ## Set seed for reproducibility
  
  lat_name &lt;- &quot;realLat&quot;                                         ## Name realLat column
  long_name &lt;- &quot;realLong&quot;                                       ## Name realLong column
  latlong &lt;- data.frame(latVector, longVector)                  ## Initialize new data frame with lat and long params
  names(latlong) &lt;- c(lat_name, long_name)                      ## Apply names to frame
  
  latlongCluster &lt;- kmeans(latlong, centers = 20, nstart = 10)  ## Run k-means clustering with centers centroids and nstart CV&#39;s
  
  group_lat &lt;- &quot;GroupLat&quot;                                       ## Name GroupLat column
  group_long &lt;- &quot;GroupLong&quot;                                     ## Name GroupLong column
  latlongCenterData &lt;- data.frame(latlongCluster$centers)       ## Initialize data frame with centers
  names(latlongCenterData) &lt;- c(group_lat, group_long)          ## Apply names to frame
  
  latlongCenterData$clusterCenter &lt;- 
    apply(latlongCenterData, 1, paste, collapse = &quot;,&quot;)          ## Combine latlongCenterData columns into a comma seperated value
  
  group_name &lt;- &quot;GroupNumber&quot;                                   ## Name GroupNumber column
  resultData &lt;- data.frame(latlongCluster$cluster)              ## Initialize data frame with kmeans clusters (region values)
  names(resultData) &lt;- c(group_name)                            ## Apply names to frame
  
  resultData &lt;- resultData %&gt;%
    mutate(LatLongCenter = 
             latlongCenterData$clusterCenter[GroupNumber])      ## Get the appropriate centroid location for each region number
  
  resultData$cluster &lt;- 
    apply(resultData, 1, paste, collapse = &quot;,&quot;)                 ## Create a new column `cluster` columns collapsed together
  
  return(resultData$cluster)                                    ## Return the comma seperated cluster data as a vector
}</code></pre>
</div>
<div id="aggregating-master-data-set" class="section level4">
<h4>Aggregating Master Data Set</h4>
<p>The code chunk below cleans, merges, and computes the master data frame for terrorist and temperature data in the UNITED STATES.</p>
<pre class="r"><code>## Get and clean only US terrorist attacks
usaTerrorismData &lt;- terrorismData %&gt;%
  filter(country == 217)  %&gt;%                                        ## Filter for country == USA
  unite(date1, iyear,imonth,iday, sep=&quot;-&quot;) %&gt;%                       ## Unite seperate year, month, and day columns into one (y-m-d)
  mutate(dateLub = ymd(date1)) %&gt;%                                   ## Convert date into &#39;Lubridate&#39; (YYYY-MM-DD)
  filter(!is.na(dateLub))  %&gt;%                                       ## Filter out observations with missing dates (failed to parse)
  mutate(city_char = str_to_lower(as.character(city))) %&gt;%           ## Create new city column as character type
  mutate(month = month(as.POSIXlt(dateLub, format=&quot;%d/%m/%Y&quot;))) %&gt;%  ## Create a new month column
  mutate(year = year(as.POSIXlt(dateLub, format=&quot;%d/%m/%Y&quot;))) %&gt;%    ## Create a new year column
  mutate(month_year = paste(month, year))                            ## Create new month, year column (M YYYY)</code></pre>
<pre><code>## Warning: 33 failed to parse.</code></pre>
<pre class="r"><code>## Uncomment to view head and dimension of cleaned usaTerrorismData
#head(usaTerrorismData)
#dim(usaTerrorismData)


## Get and clean only US temperatures
usaTemperatureData &lt;- temperatureData %&gt;%
  filter(Country == &quot;United States&quot;) %&gt;%                             ## Filter for country == USA
  mutate(dateLub = ymd(dt)) %&gt;%                                      ## Convert date into &#39;Lubridate&#39; (YYYY-MM-DD)
  filter(!is.na(dateLub)) %&gt;%                                        ## Filter out observations with missing dates (failed to parse)
  filter(dateLub &gt;= as.Date(&quot;1970-01-01&quot;)) %&gt;%                       ## Filter only for data after 1/1/1970 (when Terrorism data begins)
  mutate(city_char = str_to_lower(as.character(City))) %&gt;%           ## Create new city column as character type
  mutate(month = month(as.POSIXlt(dateLub, format=&quot;%d/%m/%Y&quot;))) %&gt;%  ## Create a new month column
  mutate(year = year(as.POSIXlt(dateLub, format=&quot;%d/%m/%Y&quot;))) %&gt;%    ## Create a new year column
  mutate(month_year = paste(month, year)) %&gt;%                        ## Create new month, year column (M YYYY)
  mutate(AverageTemperature = 
           as.numeric(as.character(AverageTemperature)))  %&gt;%        ## Type of AverageTemperature is numeric
  filter(!is.na(AverageTemperature))                                 ## Remove observations with missing temperatures</code></pre>
<pre><code>## Warning: 2 failed to parse.</code></pre>
<pre class="r"><code>## Uncomment to view head and dimension of cleaned usaTemperatureData
#head(usaTemperatureData)
#dim(usaTemperatureData)


## Merge temperature data with terrorism data by city_char and month_year
## As a result, for every city we should also have every month since 1970 (exlcuding missing data)
## (Important note: There are ~200 unique cities in our temperature data and ~700 in our terrorism data.
## As a result, when merging on cities, we lose about half of our terrorist attacks.)
mergedTempTerrorismData &lt;- left_join(usaTemperatureData, usaTerrorismData, by=c(&quot;city_char&quot;, &quot;month_year&quot;))

## Uncomment to view head and dimension of mergedTempTerrorismData
#head(mergedTempTerrorismData)
#dim(mergedTempTerrorismData)

  
## Clean mergedTempTerrorismData 
mergedTempTerrorismData &lt;- mergedTempTerrorismData[,c(&quot;month_year&quot;, &quot;month.x&quot;, &quot;year.x&quot;,
                                                      &quot;city_char&quot;, &quot;AverageTemperature&quot;, 
                                                      &quot;Latitude&quot;, &quot;Longitude&quot;, &quot;nkill&quot;, 
                                                      &quot;eventid&quot;)] %&gt;%                       ## Select explanatory variables
  filter(year.x &lt; 2016) %&gt;%                                                                 ## Filter for a couple typos in years
  mutate(isAttack = as.integer(!is.na(eventid))) %&gt;%                                        ## Create binary isAttack variable
  mutate(nkill = ifelse(is.na(nkill), 0, nkill)) %&gt;%                                        ## Convert NA&#39;s to 0&#39;s in nkill
  select(-eventid) %&gt;%                                                                      ## Remove eventid variable 
  mutate(realLong = -1* as.numeric(str_sub(Longitude, 1, -2))) %&gt;%                          ## Parse Longitude column
  mutate(realLat = as.numeric(str_sub(Latitude, 1, -2))) %&gt;%                                ## Parse Latitude column
  filter(!is.na(realLat)) %&gt;%                                                               ## Remove missing Latitudes
  filter(!is.na(realLong)) %&gt;%                                                              ## Remove missing Longitudes
  mutate(region = cluster(realLat, realLong)) %&gt;%                                           ## Get comma seperated region cluster (r,lat,long)
  separate(region, sep=&quot;,&quot;, into=c(&quot;Region&quot;, &quot;RegionLat&quot;, &quot;RegionLong&quot;), convert=TRUE) %&gt;%  ## Seperate comma-seperated data into the 3 columns
  select(-Latitude, -Longitude)                                                             ## Remove Latitude and Longitude char vectors
  

## Create additional explanatory variables for mergedTempTerrorismData
mergedTempTerrorismData &lt;- mergedTempTerrorismData %&gt;%
  group_by(Region, month.x) %&gt;%                                                             ## Group by clustered Region and month
  mutate(AvgTempReg = mean(AverageTemperature)) %&gt;%                                         ## Compute average temperature per month per region
  mutate(TempDifference = abs(AvgTempReg - AverageTemperature))                             ## Compute temperature diff b/w mean and actual

## Create additional explanatory variables for mergedTempTerrorismData
mergedTempTerrorismData &lt;- mergedTempTerrorismData %&gt;%
  group_by(Region, year.x) %&gt;%                                                              ## Group by clustered Region and year
  mutate(AttacksInYearInReg = sum(isAttack)) %&gt;%                                            ## Sum the # of attacks in region in year
  mutate(nKilledInYearInReg = sum(nkill)) %&gt;%                                               ## Sum the # of kills in region in year
  group_by(Region) %&gt;%                                                                      ## Regroup by just Region
  mutate(AvgAttacksPerYearInReg = mean(AttacksInYearInReg)) %&gt;%                             ## Compute mean attacks per year in every region
  mutate(AvgNKilledPerYearInReg = mean(nKilledInYearInReg)) %&gt;%                             ## Compute mean # killed per year in every region
  group_by(city_char) %&gt;%                                                                   ## Regroup by just city_char
  mutate(AttacksPrevYearInReg = 
           ifelse(year.x == 1970, AvgAttacksPerYearInReg, lag(AttacksInYearInReg,12))) %&gt;%  ## Compute # of attacks in prev. year in region
  mutate(nKilledPrevYearInReg = 
           ifelse(year.x == 1970, AvgNKilledPerYearInReg, lag(nKilledInYearInReg,12))) %&gt;%  ## Compute # killed in prev. year in region
  ungroup(city_char)                                                                        ## Ungroup city_char grouping
 
## Uncomment to view head, dimension, and random sampling of cleaned mergedTempTerrorismData
#head(mergedTempTerrorismData,10)
#dim(mergedTempTerrorismData)
#mergedTempTerrorismData[sample(nrow(mergedTempTerrorismData), 10),]</code></pre>
<p>Now we must clean our master data for a neural network. This includes filtering out insignificant or unnecessary variables (both categorical and some numerical). We must also check to make sure our data frame contains no missing (na) values.</p>
<pre class="r"><code>## First check to make sure we do not have any missing values in our data frame.
## Uncomment below to run and display the check.
#apply(mergedTempTerrorismData,2,function(x) sum(is.na(x)))

nnData &lt;- mergedTempTerrorismData %&gt;%
  select(month.x, isAttack, Region, TempDifference, 
         AttacksPrevYearInReg, nKilledPrevYearInReg)                           ## Select explanatory variables

## Uncomment to view head and dimension of nnData
#head(nnData,10)
#dim(nnData)</code></pre>
<p>Neural network model:</p>
<pre class="r"><code>set.seed(4747)                                                                 ## Set seed for neural net reproducibility

max = apply(nnData, 2, max)                                                    ## Get max of data
min = apply(nnData, 2, min)                                                    ## Get min of data   
scaledData = as.data.frame(scale(nnData, center=min, scale=max-min))           ## scale data from min to max

sampleSize = 0.05 * nrow(scaledData)                                            ## Sample from 2/3 of the observations
index = sample(seq_len(nrow(scaledData)), size=sampleSize)                     ## Compute index sample

trainNNData &lt;- scaledData[index,]                                              ## Get training set
testNNData &lt;- scaledData[-index,]                                              ## Get test set

neuralNet &lt;-neuralnet(isAttack~month.x+Region+TempDifference+
                      AttacksPrevYearInReg+nKilledPrevYearInReg, 
                      trainNNData, hidden=3, linear.output=TRUE)               ## Fit neural network on data

plot(neuralNet)                                                                ## Plot the neural network

plot.nnet(neuralNet, cex.val = 0.5)                                            ## Plot the neural network with a nicer library</code></pre>
<p>Assess the neural network:</p>
<pre class="r"><code>predictTestNN &lt;- compute(neuralNet, testNNData[c(&quot;month.x&quot;, &quot;Region&quot;, 
                                                 &quot;TempDifference&quot;, 
                                                 &quot;AttacksPrevYearInReg&quot;, 
                                                 &quot;nKilledPrevYearInReg&quot;)])     ## Compute test results in the neural net

results &lt;- data.frame(actual=testNNData$isAttack, 
                      prediction=predictTestNN$net.result)
head(results)                                                                  ## Display head of results in a data frame</code></pre>
<pre><code>##   actual    prediction
## 1      0 0.01513790190
## 2      0 0.01208049433
## 3      0 0.01904329853
## 4      0 0.01217266339
## 5      0 0.01255871812
## 6      0 0.01231850571</code></pre>
<pre class="r"><code>roundedresults&lt;-sapply(results,round,digits=0)
roundedresultsdf&lt;-data.frame(roundedresults)
attach(roundedresultsdf)</code></pre>
<pre><code>## The following objects are masked from roundedresultsdf (pos = 3):
## 
##     actual, prediction</code></pre>
<pre><code>## The following objects are masked from roundedresultsdf (pos = 4):
## 
##     actual, prediction</code></pre>
<pre class="r"><code>table(actual, prediction)                                                      ## Table of predictions v actual</code></pre>
<pre><code>##       prediction
## actual      0
##      0 139231
##      1   1195</code></pre>
<pre class="r"><code>results %&gt;%
  group_by(actual) %&gt;%
  summarise(mean(prediction))                                                  ## Compute average probability predication for an attack vs non-attack</code></pre>
<pre><code>## # A tibble: 2 x 2
##   actual `mean(prediction)`
##    &lt;dbl&gt;              &lt;dbl&gt;
## 1      0     0.007997439193
## 2      1     0.013216557007</code></pre>
<pre class="r"><code>garson(neuralNet)                                                              ## Plot variable importance</code></pre>
<p><img src="MasterData_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>That did alright, but now let’s try to predict whether a terrorist attack is going to happen in a given year, rather than a given day in a region. This is going to require a bit of data re-wrangling to get the appropriate explanatory variables.</p>
<pre class="r"><code># want additional isAttackYear, TempDifferenceYear
mergedTempTerrorismDataYear &lt;- mergedTempTerrorismData %&gt;%
  group_by(Region, year.x) %&gt;%                                                  ## Group by Region and year.x
  mutate(isAttackYear = ifelse(sum(isAttack) &gt; 0, 1, 0)) %&gt;%                    ## Create isAttackYear var, was there an attack in year in reg?
  mutate(AvgTempRegYear = mean(AverageTemperature)) %&gt;%                         ## Create AvgTempRegYear var, avg temp in reg in year
  group_by(Region) %&gt;%                                                          ## Regroup by just Region
  mutate(HistAvgTemp = mean(AverageTemperature)) %&gt;%                            ## Compute HistAvgTemp per region over all years
  group_by(Region, year.x) %&gt;%                                                  ## Regroup by Region and year.x
  mutate(TempDifferenceYear = abs(HistAvgTemp - AvgTempRegYear)) %&gt;%            ## Compute the difference in temp between year and hist avg
  ungroup(Region, year.x)                                                       ## Ungroup all groupings

## Uncomment to view head and dimension of mergedTempTerrorismDataYear
#head(mergedTempTerrorismDataYear,20)
#dim(mergedTempTerrorismDataYear)</code></pre>
<p>Again we must clean our data for the neural net;</p>
<pre class="r"><code>## First check to make sure we do not have any missing values in our data frame.
## Uncomment below to run and display the check.
#apply(mergedTempTerrorismDataYear,2,function(x) sum(is.na(x)))

nnDataYear &lt;- mergedTempTerrorismDataYear %&gt;%
  select(year.x, isAttackYear, Region, TempDifferenceYear, 
         AttacksPrevYearInReg, nKilledPrevYearInReg)                           ## Select explanatory variables

nnDataYear &lt;- nnDataYear %&gt;%
  group_by(Region, year.x) %&gt;%
  summarise_all(funs(mean))

## Uncomment to view head and dimension of nnData
#head(nnDataYear,10)
#dim(nnDataYear)</code></pre>
<p>Again, we are going to train another neural net model</p>
<pre class="r"><code>set.seed(4747)                                                                 ## Set seed for neural net reproducibility

max = apply(nnDataYear, 2, max)                                                    ## Get max of data
min = apply(nnDataYear, 2, min)                                                    ## Get min of data   
scaledDataYear = as.data.frame(scale(nnDataYear, center=min, scale=max-min))           ## scale data from min to max

sampleSize = 0.67 * nrow(scaledDataYear)                                            ## Sample from 2/3 of the observations
index = sample(seq_len(nrow(scaledDataYear)), size=sampleSize)                     ## Compute index sample

trainNNDataYear &lt;- scaledDataYear[index,]                                              ## Get training set
testNNDataYear &lt;- scaledDataYear[-index,]                                              ## Get test set

neuralNetYear &lt;-neuralnet(isAttackYear~Region+TempDifferenceYear+
                      AttacksPrevYearInReg+nKilledPrevYearInReg, 
                      trainNNDataYear, hidden=3, linear.output=TRUE)               ## Fit neural network on data

plot(neuralNetYear)                                                                ## Plot the neural network

plot.nnet(neuralNetYear, cex.val = 0.5)                                            ## Plot the neural network with a nicer library</code></pre>
<p>Assess the new neural network on year:</p>
<pre class="r"><code>predictTestNNYear &lt;- compute(neuralNetYear, testNNDataYear[c(&quot;Region&quot;, 
                                                 &quot;TempDifferenceYear&quot;, 
                                                 &quot;AttacksPrevYearInReg&quot;, 
                                                 &quot;nKilledPrevYearInReg&quot;)])     ## Compute test results in the neural net

resultsYear &lt;- data.frame(actual=testNNDataYear$isAttackYear, 
                      prediction=predictTestNNYear$net.result)
head(resultsYear  )                                                            ## Display head of results in a data frame</code></pre>
<pre><code>##    actual   prediction
## 4       0 0.1634625156
## 5       0 0.1635298512
## 6       1 0.1634625156
## 9       0 0.1634725187
## 11      1 0.1634722189
## 12      1 0.2303895829</code></pre>
<pre class="r"><code>roundedresults&lt;-sapply(resultsYear,round,digits=0)
roundedresultsdf&lt;-data.frame(roundedresults)
attach(roundedresultsdf)</code></pre>
<pre><code>## The following objects are masked from roundedresultsdf (pos = 3):
## 
##     actual, prediction</code></pre>
<pre><code>## The following objects are masked from roundedresultsdf (pos = 4):
## 
##     actual, prediction</code></pre>
<pre><code>## The following objects are masked from roundedresultsdf (pos = 5):
## 
##     actual, prediction</code></pre>
<pre class="r"><code>table(actual, prediction)                                                      ## Table of predictions v actual</code></pre>
<pre><code>##       prediction
## actual   0   1
##      0 139  31
##      1  71  50</code></pre>
<pre class="r"><code>resultsYear %&gt;%
  group_by(actual) %&gt;%
  summarise(mean(prediction))                                                  ## Compute average probability predication for an attack vs non-attack</code></pre>
<pre><code>## # A tibble: 2 x 2
##   actual `mean(prediction)`
##    &lt;dbl&gt;              &lt;dbl&gt;
## 1      0       0.3649511678
## 2      1       0.4981493106</code></pre>
<pre class="r"><code>garson(neuralNetYear)                                                          ## Plot variable importance</code></pre>
<p><img src="MasterData_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>Here we will create some visualizations</p>
<pre class="r"><code>deathViz &lt;- usaTerrorismData %&gt;%                         # Create dataset to visualize          
  filter(provstate != &quot;Puerto Rico&quot;) %&gt;%                     # Remove Puerto Rico
  filter(provstate != &quot;Alaska&quot;) %&gt;%                          # Remove Alaska
  filter(provstate != &quot;Hawaii&quot;)  %&gt;%                         # Remove Hawaii
  filter(longitude &lt; 0) %&gt;%                                  # Remove Locations East of Prime Meridien
  filter(!is.na(nkill))                                      # Get rid of NA&#39;s

deathViz &lt;- deathViz %&gt;%                             
  group_by(provstate) %&gt;%                                   # Group by state
  summarize(totalKilled = sum(nkill)) %&gt;%                   # Sum number of deaths 
  mutate(code = state.abb[match(provstate,state.name)])     # Add state abbreviations

deathViz$hover &lt;- with(deathViz,
                           paste(provstate, &#39;&lt;br&gt;&#39;, &quot;Number Killed&quot;, totalKilled))  # Create a Variable                                                                                     # for hovering
                                                            
l &lt;- list(color = toRGB(&quot;white&quot;), width = 2)                   # give state boundaries a white border
g &lt;- list(                                                     # specify some map projection/options
  scope = &#39;usa&#39;,
  projection = list(type = &#39;albers usa&#39;),
  showlakes = TRUE,
  lakecolor = toRGB(&#39;white&#39;)
)

p1 &lt;- plot_geo(deathViz, locationmode = &#39;USA-states&#39;) %&gt;%
  add_trace(
    z = ~ totalKilled, text = ~hover, locations = ~code,
    color = ~totalKilled, colors = &#39;Reds&#39;
  ) %&gt;%
  colorbar(title = &quot;Deaths&quot;) %&gt;%
  layout(
    title = &#39;Deaths From Terrorist Attacks Since 1970&#39;,
    geo = g
  )
 
p1</code></pre>
<div id="11a05525756b5" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="11a05525756b5">{"x":{"visdat":{"11a052f798244":["function () ","plotlyVisDat"]},"cur_data":"11a052f798244","attrs":{"11a052f798244":{"locationmode":"USA-states","alpha":1,"sizes":[10,100],"z":{},"text":{},"locations":{},"color":{},"colors":"Reds"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"mapType":"geo","scene":{"zaxis":{"title":"totalKilled"}},"geo":{"domain":{"x":[0,1],"y":[0,1]},"scope":"usa","projection":{"type":"albers usa"},"showlakes":true,"lakecolor":"rgba(255,255,255,1)"},"hovermode":"closest","showlegend":false,"legend":{"y":0.5,"yanchor":"top"},"title":"Deaths From Terrorist Attacks Since 1970"},"source":"A","config":{"modeBarButtonsToAdd":[{"name":"Collaborate","icon":{"width":1000,"ascent":500,"descent":-50,"path":"M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z"},"click":"function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == '?viewer_pane=1') {\n          alert('To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html');\n        } else {\n          window.open('https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html', '_blank');\n        }\n      }"}],"cloud":false},"data":[{"colorbar":{"title":"Deaths","ticklen":2,"len":0.5,"y":1,"lenmode":"fraction","yanchor":"top"},"colorscale":[["0","rgba(255,245,240,1)"],["0.000354233085370174","rgba(255,245,240,1)"],["0.000708466170740347","rgba(255,245,240,1)"],["0.00141693234148069","rgba(255,245,240,1)"],["0.00177116542685087","rgba(255,245,240,1)"],["0.00212539851222104","rgba(255,245,239,1)"],["0.00247963159759122","rgba(255,245,239,1)"],["0.00283386468296139","rgba(255,245,239,1)"],["0.00318809776833156","rgba(255,244,239,1)"],["0.00389656393907191","rgba(255,244,239,1)"],["0.00425079702444208","rgba(255,244,239,1)"],["0.00637619553666312","rgba(255,244,238,1)"],["0.0152320226709175","rgba(255,242,236,1)"],["0.0226709174636911","rgba(255,241,235,1)"],["0.0602196245129295","rgba(255,235,225,1)"],["1","rgba(103,0,13,1)"]],"showscale":true,"locationmode":"USA-states","z":[5,4,2,79,21,2,0,17,64,7,0,6,4,0,4,0,18,0,8,12,5,2,1,2,0,1,6,0,11,0,2823,9,2,8,170,0,51,0,9,2,12,43,3,0,196,6,0,8,0],"text":["Alabama <br> Number Killed 5","Arizona <br> Number Killed 4","Arkansas <br> Number Killed 2","California <br> Number Killed 79","Colorado <br> Number Killed 21","Connecticut <br> Number Killed 2","Delaware <br> Number Killed 0","District of Columbia <br> Number Killed 17","Florida <br> Number Killed 64","Georgia <br> Number Killed 7","Idaho <br> Number Killed 0","Illinois <br> Number Killed 6","Indiana <br> Number Killed 4","Iowa <br> Number Killed 0","Kansas <br> Number Killed 4","Kentucky <br> Number Killed 0","Louisiana <br> Number Killed 18","Maine <br> Number Killed 0","Maryland <br> Number Killed 8","Massachusetts <br> Number Killed 12","Michigan <br> Number Killed 5","Minnesota <br> Number Killed 2","Mississippi <br> Number Killed 1","Missouri <br> Number Killed 2","Montana <br> Number Killed 0","Nebraska <br> Number Killed 1","Nevada <br> Number Killed 6","New Hampshire <br> Number Killed 0","New Jersey <br> Number Killed 11","New Mexico <br> Number Killed 0","New York <br> Number Killed 2823","North Carolina <br> Number Killed 9","North Dakota <br> Number Killed 2","Ohio <br> Number Killed 8","Oklahoma <br> Number Killed 170","Oregon <br> Number Killed 0","Pennsylvania <br> Number Killed 51","Rhode Island <br> Number Killed 0","South Carolina <br> Number Killed 9","South Dakota <br> Number Killed 2","Tennessee <br> Number Killed 12","Texas <br> Number Killed 43","Utah <br> Number Killed 3","Vermont <br> Number Killed 0","Virginia <br> Number Killed 196","Washington <br> Number Killed 6","West Virginia <br> Number Killed 0","Wisconsin <br> Number Killed 8","Wyoming <br> Number Killed 0"],"locations":["AL","AZ","AR","CA","CO","CT","DE",null,"FL","GA","ID","IL","IN","IA","KS","KY","LA","ME","MD","MA","MI","MN","MS","MO","MT","NE","NV","NH","NJ","NM","NY","NC","ND","OH","OK","OR","PA","RI","SC","SD","TN","TX","UT","VT","VA","WA","WV","WI","WY"],"type":"choropleth","geo":"geo","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1}},"base_url":"https://plot.ly"},"evals":["config.modeBarButtonsToAdd.0.click"],"jsHooks":{"render":[{"code":"function(el, x) { var ctConfig = crosstalk.var('plotlyCrosstalkOpts').set({\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1}}); }","data":null},{"code":"function(el, x) { var ctConfig = crosstalk.var('plotlyCrosstalkOpts').set({\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1}}); }","data":null}]}}</script>
<pre class="r"><code>deathVizNoNy &lt;- usaTerrorismData %&gt;%                         # Create dataset to visualize          
  filter(provstate != &quot;Puerto Rico&quot;) %&gt;%                     # Remove Puerto Rico
  filter(provstate != &quot;Alaska&quot;) %&gt;%                          # Remove Alaska
  filter(provstate != &quot;New York&quot;) %&gt;%                        # Remove New York
  filter(provstate != &quot;Hawaii&quot;)  %&gt;%                         # Remove Hawaii
  filter(longitude &lt; 0) %&gt;%                                  # Remove Locations East of Prime Meridien
  filter(!is.na(nkill))                                      # Get rid of NA&#39;s

deathVizNoNy &lt;- deathVizNoNy %&gt;%                             
  group_by(provstate) %&gt;%                                   # Group by state
  summarize(totalKilled = sum(nkill)) %&gt;%                   # Sum number of deaths 
  mutate(code = state.abb[match(provstate,state.name)])     # Add state abbreviations

deathVizNoNy$hover &lt;- with(deathVizNoNy,
                           paste(provstate, &#39;&lt;br&gt;&#39;, &quot;Number Killed&quot;, totalKilled))  # Create a Variable                                                                                     # for hovering
p2 &lt;- plot_geo(deathVizNoNy, locationmode = &#39;USA-states&#39;) %&gt;%
  add_trace(
    z = ~ totalKilled, text = ~hover, locations = ~code,
    color = ~totalKilled, colors = &#39;Reds&#39;
  ) %&gt;%
  colorbar(title = &quot;Deaths&quot;) %&gt;%
  layout(
    title = &#39;Deaths From Terrorist Attacks Since 1970 Excluding New York&#39;,
    geo = g
  )
 
p2</code></pre>
<div id="11a0517d8cc76" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="11a0517d8cc76">{"x":{"visdat":{"11a051021c050":["function () ","plotlyVisDat"]},"cur_data":"11a051021c050","attrs":{"11a051021c050":{"locationmode":"USA-states","alpha":1,"sizes":[10,100],"z":{},"text":{},"locations":{},"color":{},"colors":"Reds"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"mapType":"geo","scene":{"zaxis":{"title":"totalKilled"}},"geo":{"domain":{"x":[0,1],"y":[0,1]},"scope":"usa","projection":{"type":"albers usa"},"showlakes":true,"lakecolor":"rgba(255,255,255,1)"},"hovermode":"closest","showlegend":false,"legend":{"y":0.5,"yanchor":"top"},"title":"Deaths From Terrorist Attacks Since 1970 Excluding New York"},"source":"A","config":{"modeBarButtonsToAdd":[{"name":"Collaborate","icon":{"width":1000,"ascent":500,"descent":-50,"path":"M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z"},"click":"function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == '?viewer_pane=1') {\n          alert('To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html');\n        } else {\n          window.open('https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html', '_blank');\n        }\n      }"}],"cloud":false},"data":[{"colorbar":{"title":"Deaths","ticklen":2,"len":0.5,"y":1,"lenmode":"fraction","yanchor":"top"},"colorscale":[["0","rgba(255,245,240,1)"],["0.00510204081632653","rgba(255,244,239,1)"],["0.0102040816326531","rgba(255,243,238,1)"],["0.0180697278911565","rgba(255,242,236,1)"],["0.0204081632653061","rgba(255,242,235,1)"],["0.0255102040816327","rgba(255,241,234,1)"],["0.0306122448979592","rgba(255,240,233,1)"],["0.0325255102040816","rgba(255,240,232,1)"],["0.0408163265306122","rgba(255,238,230,1)"],["0.0423044217687075","rgba(255,238,230,1)"],["0.048469387755102","rgba(255,237,228,1)"],["0.0612244897959184","rgba(255,235,225,1)"],["0.0875850340136054","rgba(254,230,219,1)"],["0.121173469387755","rgba(254,225,211,1)"],["0.265731292517007","rgba(252,182,155,1)"],["0.422406462585033","rgba(252,131,99,1)"],["1","rgba(103,0,13,1)"]],"showscale":true,"locationmode":"USA-states","z":[5,4,2,79,21,2,0,17,64,7,0,6,4,0,4,0,18,0,8,12,5,2,1,2,0,1,6,0,11,0,9,2,8,170,0,51,0,9,2,12,43,3,0,196,6,0,8,0],"text":["Alabama <br> Number Killed 5","Arizona <br> Number Killed 4","Arkansas <br> Number Killed 2","California <br> Number Killed 79","Colorado <br> Number Killed 21","Connecticut <br> Number Killed 2","Delaware <br> Number Killed 0","District of Columbia <br> Number Killed 17","Florida <br> Number Killed 64","Georgia <br> Number Killed 7","Idaho <br> Number Killed 0","Illinois <br> Number Killed 6","Indiana <br> Number Killed 4","Iowa <br> Number Killed 0","Kansas <br> Number Killed 4","Kentucky <br> Number Killed 0","Louisiana <br> Number Killed 18","Maine <br> Number Killed 0","Maryland <br> Number Killed 8","Massachusetts <br> Number Killed 12","Michigan <br> Number Killed 5","Minnesota <br> Number Killed 2","Mississippi <br> Number Killed 1","Missouri <br> Number Killed 2","Montana <br> Number Killed 0","Nebraska <br> Number Killed 1","Nevada <br> Number Killed 6","New Hampshire <br> Number Killed 0","New Jersey <br> Number Killed 11","New Mexico <br> Number Killed 0","North Carolina <br> Number Killed 9","North Dakota <br> Number Killed 2","Ohio <br> Number Killed 8","Oklahoma <br> Number Killed 170","Oregon <br> Number Killed 0","Pennsylvania <br> Number Killed 51","Rhode Island <br> Number Killed 0","South Carolina <br> Number Killed 9","South Dakota <br> Number Killed 2","Tennessee <br> Number Killed 12","Texas <br> Number Killed 43","Utah <br> Number Killed 3","Vermont <br> Number Killed 0","Virginia <br> Number Killed 196","Washington <br> Number Killed 6","West Virginia <br> Number Killed 0","Wisconsin <br> Number Killed 8","Wyoming <br> Number Killed 0"],"locations":["AL","AZ","AR","CA","CO","CT","DE",null,"FL","GA","ID","IL","IN","IA","KS","KY","LA","ME","MD","MA","MI","MN","MS","MO","MT","NE","NV","NH","NJ","NM","NC","ND","OH","OK","OR","PA","RI","SC","SD","TN","TX","UT","VT","VA","WA","WV","WI","WY"],"type":"choropleth","geo":"geo","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1}},"base_url":"https://plot.ly"},"evals":["config.modeBarButtonsToAdd.0.click"],"jsHooks":{"render":[{"code":"function(el, x) { var ctConfig = crosstalk.var('plotlyCrosstalkOpts').set({\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1}}); }","data":null},{"code":"function(el, x) { var ctConfig = crosstalk.var('plotlyCrosstalkOpts').set({\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1}}); }","data":null}]}}</script>
<p>Now we will make an even more interactive visualization</p>
<pre class="r"><code>interactiveViz &lt;- usaTerrorismData %&gt;%                        # Create dataset to visualize          
  filter(provstate != &quot;Puerto Rico&quot;) %&gt;%                     # Remove Puerto Rico
  filter(provstate != &quot;Alaska&quot;) %&gt;%                          # Remove Alaska
  filter(provstate != &quot;Hawaii&quot;)  %&gt;%                         # Remove Hawaii
  filter(longitude &lt; 0) %&gt;%                                  # Remove Locations East of Prime Meridien
  filter(!is.na(nkill))                                      # Get rid of NA&#39;s
   
interactiveViz &lt;- interactiveViz %&gt;%          
  group_by(provstate, year, latitude, longitude) %&gt;%    # group attacks by year, state, lat, and long
  summarize(totalKilled = sum(nkill))               # sum the number of deaths from terrorist attacks

# set up the user interace for visualization
ui &lt;- bootstrapPage(
  tags$style(type = &quot;text/css&quot;, &quot;html, body {width:100%;height:100%}&quot;),
  leafletOutput(&quot;map&quot;, width = &quot;100%&quot;, height = &quot;100%&quot;),
  absolutePanel(top = 10, right = 10,
    sliderInput(&quot;range&quot;, &quot;Deaths&quot;, min(interactiveViz$year), max(interactiveViz$year),
      value = range(interactiveViz$year), step = 1
    ),
    selectInput(&quot;colors&quot;, &quot;Color Scheme&quot;,
      rownames(subset(brewer.pal.info, category %in% c(&quot;seq&quot;, &quot;div&quot;)))
    ),
    checkboxInput(&quot;legend&quot;, &quot;Show legend&quot;, TRUE)
  )
)

# function to create interactive map
server &lt;- function(input, output, session) {

  # Reactive expression for the data subsetted to what the user selected
  filteredData &lt;- reactive({
    interactiveViz[interactiveViz$year &gt;= 
                            input$range[1] &amp; interactiveViz$year &lt;= input$range[2],]
  })

  # This reactive expression represents the palette function,
  # which changes as the user makes selections in UI.
  colorpal &lt;- reactive({
    colorNumeric(input$colors, interactiveViz$totalKilled)
  })

  output$map &lt;- renderLeaflet({
    # Use leaflet() here, and only include aspects of the map that
    # won&#39;t need to change dynamically (at least, not unless the
    # entire map is being torn down and recreated).
    leaflet(interactiveViz) %&gt;% addTiles() %&gt;%
      fitBounds(~min(longitude), ~min(latitude), ~max(longitude), ~max(latitude))
  })

  # Incremental changes to the map (in this case, replacing the
  # circles when a new color is chosen) should be performed in
  # an observer. Each independent set of things that can change
  # should be managed in its own observer.
  observe({
    pal &lt;- colorpal()

    leafletProxy(&quot;map&quot;, data = filteredData()) %&gt;%
      clearShapes() %&gt;%
      addCircles(radius = ~((50*(totalKilled + 1)) + 5), weight = 1, color = &quot;#777777&quot;,
        fillColor = ~pal(totalKilled), fillOpacity = 0.7, popup = ~paste(totalKilled)
      )
  })

  # Use a separate observer to recreate the legend as needed.
  observe({
    proxy &lt;- leafletProxy(&quot;map&quot;, data = interactiveViz)

    # Remove any existing legend, and only if the legend is
    # enabled, create a new one.
    proxy %&gt;% clearControls()
    if (input$legend) {
      pal &lt;- colorpal()
      proxy %&gt;% addLegend(position = &quot;bottomright&quot;,
        pal = pal, values = ~totalKilled
      )
    }
  })
}

shinyApp(ui, server)</code></pre>
<div style="width: 100% ; height: 400px ; text-align: center; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box;" class="muted well">Shiny applications not supported in static R Markdown documents</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
